# Generated by Django 5.2.1 on 2025-05-13 09:49

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('accounts', '0004_alter_manager_options_alter_person_options_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='Author',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=70, verbose_name='Название')),
                ('revenue', models.CharField(blank=True, verbose_name='Ожидаемый оборот/прибыль')),
                ('reward_percent', models.DecimalField(decimal_places=2, max_digits=8, verbose_name='Процент')),
                ('reward_type', models.CharField(choices=[('turnover', 'Оборот'), ('profit', 'прибыль')], default='turnover', verbose_name='Тип награды')),
                ('currency', models.CharField(choices=[('rub', 'RUB'), ('usd', 'USD')], default='rub', verbose_name='Тип валюты')),
                ('author', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.person')),
                ('thead', models.ManyToManyField(blank=True, related_name='author_theads', to='accounts.person')),
            ],
        ),
        migrations.CreateModel(
            name='Contract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_nunber', models.PositiveIntegerField(auto_created=True, verbose_name='Номер контракта')),
                ('created_at', models.DateField(verbose_name='Дата создание')),
                ('started_at', models.DateField(verbose_name='Запуск контракта')),
                ('ended_at', models.DateField(verbose_name='Окончание контракта')),
                ('comment_manager', models.TextField(verbose_name='Комментарий менеджера')),
                ('authors', models.ManyToManyField(blank=True, related_name='contracts', to='contracts.author')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='created_contracts', to='accounts.manager', verbose_name='Кто завел контракт')),
                ('responsible_manager', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='responsible_contracts', to='accounts.manager', verbose_name='Ответственный сотрудник')),
            ],
            options={
                'verbose_name': 'Контракт',
                'verbose_name_plural': 'Контракты',
            },
        ),
        migrations.CreateModel(
            name='Accrual',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_type', models.CharField(blank=True, choices=[('author', 'Авторский'), ('presenter', 'Ведущий')], max_length=20, null=True, verbose_name='Тип контракта')),
                ('accrual_flags', models.CharField(choices=[('collapsed', 'Схлопнутое'), ('correction', 'Корректировка'), ('non_financial', 'Нефинансовое')], default=None)),
                ('accrual_status', models.CharField(choices=[('pending', 'Ожидание'), ('verified', 'Проверено')], default='pending')),
                ('payed', models.BooleanField(default=False, verbose_name='Оплата')),
                ('comment_manager', models.TextField(blank=True, null=True, verbose_name='Комментарий менеджера')),
                ('calculation_formula', models.JSONField(blank=True, default=dict, help_text='Автоматически подставляется при сохранении', verbose_name='Формула расчета')),
                ('hours_worked', models.FloatField(blank=True, null=True, verbose_name='Фактические часы')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.manager', verbose_name='Кто завел начисление')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_accruals', to='accounts.manager', verbose_name='Кто изменил начисление')),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='contracts.contract')),
            ],
        ),
        migrations.CreateModel(
            name='Presenter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=70, verbose_name='Название')),
                ('estimate', models.FloatField(verbose_name='Прогнозное кол-во часов')),
                ('hourly_rate', models.FloatField(verbose_name='Ставка за час')),
                ('currency', models.CharField(choices=[('rub', 'RUB'), ('usd', 'USD')], default='rub', verbose_name='Тип валюты')),
                ('presenter', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.person')),
                ('thead', models.ManyToManyField(blank=True, related_name='presenter_theads', to='accounts.person')),
            ],
        ),
        migrations.AddField(
            model_name='contract',
            name='presenters',
            field=models.ManyToManyField(blank=True, related_name='contracts', to='contracts.presenter'),
        ),
    ]
